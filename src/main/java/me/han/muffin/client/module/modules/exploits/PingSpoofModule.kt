package me.han.muffin.client.module.modules.exploits

import me.han.muffin.client.core.Globals
import me.han.muffin.client.event.EventStageable
import me.han.muffin.client.event.events.network.PacketEvent
import me.han.muffin.client.module.Module
import me.han.muffin.client.value.NumberValue
import net.minecraft.network.play.client.CPacketKeepAlive
import net.minecraft.network.play.server.SPacketKeepAlive
import team.stiff.pomelo.impl.annotated.handler.annotation.Listener
import java.util.*

object PingSpoofModule: Module("PingSpoof", Category.EXPLOITS,"Spoof your server ping higher.") {
    private val delay = NumberValue(200, 0, 2000, 25,"Delay")

    init {
        addSettings(delay)
    }

    @Listener
    private fun onPacketReceive(event: PacketEvent.Receive) {
        if (event.stage != EventStageable.EventStage.PRE || fullNullCheck()) return

        if (event.packet !is SPacketKeepAlive) return

        event.cancel()
        Timer().schedule(object : TimerTask() {
            override fun run() {
                Globals.mc.connection?.sendPacket(CPacketKeepAlive(event.packet.id))
            }
        }, delay.value.toLong())
    }

}